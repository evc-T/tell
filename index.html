<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Link Center</title>
  <style>
    /* Import DM Sans font */
    @import url("https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,100..1000&display=swap");

    /* CSS Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Configuration variables - Edit these to customize */
    :root {
      --site-title: "Link Center";
      --site-subtitle: "All my links in one place";
      --maker-name: "YourName";
      --maker-url: "https://your.site";
      --background-image: url(./pattern.jpg); /* e.g., url('https://example.com/bg.jpg') */
      --background-color: #f0f0f0;
      --text-primary: #224;
      --text-secondary: #666666;
    }

    /* Light Theme (Default) */
    :root {
      --c-glass: #bbbbbc;
      --c-light: #fff;
      --c-dark: #000;
      --c-content: #224;
      --c-action: #0052f5;
      --c-bg: var(--background-color);
      --glass-reflex-dark: 1;
      --glass-reflex-light: 1;
      --saturation: 150%;
      --border-radius: 18px;
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --accent: var(--c-action);
    }

    /* Dark Theme */
    body.dark-theme {
      --c-glass: #bbbbbc;
      --c-light: #fff;
      --c-dark: #000;
      --c-content: #e1e1e1;
      --c-action: #4d9eff;
      --c-bg: #121212;
      --glass-reflex-dark: 2;
      --glass-reflex-light: 0.3;
      --saturation: 150%;
      --text-primary: #ffffff;
      --text-secondary: #cccccc;
    }

    /* Base body styles */
    body {
      font-size: 20px;
      font-family: "DM Sans", sans-serif;
      font-optical-sizing: auto;
      background: var(--c-bg);
      color: var(--c-content);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: background 400ms cubic-bezier(1, 0, 0.4, 1),
        color 400ms cubic-bezier(1, 0, 0.4, 1);
      background-image: var(--background-image);
      background-repeat: repeat;
      background-position: top left;
      background-size: 100px; /* Made pattern smaller */
    }

    /* Theme switcher styles */
    .theme-switcher {
      position: fixed;
      z-index: 100;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      width: 50px;
      padding: 8px;
      border: none;
      border-radius: 99em;
      background-color: color-mix(in srgb, var(--c-glass) 12%, transparent);
      backdrop-filter: blur(8px) saturate(var(--saturation));
      -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
      box-shadow: inset 0 0 0 1px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 10%),
            transparent
          ),
        inset 1.8px 3px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 90%),
            transparent
          ),
        inset -2px -2px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 80%),
            transparent
          ),
        inset -3px -8px 1px -6px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 60%),
            transparent
          ),
        inset -0.3px -1px 4px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 12%),
            transparent
          ),
        inset -1.5px 2.5px 0px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 20%),
            transparent
          ),
        inset 0px 3px 4px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 20%),
            transparent
          ),
        inset 2px -6.5px 1px -4px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 10%),
            transparent
          ),
        0px 1px 5px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 10%),
            transparent
          ),
        0px 6px 16px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 8%),
            transparent
          );
      transition: background-color 400ms cubic-bezier(1, 0, 0.4, 1),
        box-shadow 400ms cubic-bezier(1, 0, 0.4, 1);
    }

    .theme-switcher__legend {
      position: absolute;
      width: 1px;
      height: 1px;
      margin: -1px;
      border: 0;
      padding: 0;
      white-space: nowrap;
      clip-path: inset(100%);
      clip: rect(0 0 0 0);
      overflow: hidden;
    }

    .theme-switcher__input {
      clip: rect(0 0 0 0);
      clip-path: inset(100%);
      height: 1px;
      width: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
    }

    .theme-switcher__icon {
      display: block;
      width: 100%;
      transition: scale 200ms cubic-bezier(0.5, 0, 0, 1);
    }

    .theme-switcher__option {
      --c: var(--c-content);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px;
      width: 36px;
      height: 36px;
      box-sizing: border-box;
      border-radius: 99em;
      opacity: 1;
      transition: all 160ms;
    }

    .theme-switcher__option:hover {
      --c: var(--c-action);
      cursor: pointer;
    }

    .theme-switcher__option:hover .theme-switcher__icon {
      scale: 1.2;
    }

    .theme-switcher__option:has(input:checked) {
      --c: var(--c-content);
      cursor: auto;
    }

    .theme-switcher__option:has(input:checked) .theme-switcher__icon {
      scale: 1;
    }

    /* Main container */
    .container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }

    /* Liquid Glass Card */
    .glass-card {
      width: 100%;
      background-color: color-mix(in srgb, var(--c-glass) 12%, transparent);
      backdrop-filter: blur(25px) saturate(var(--saturation));
      -webkit-backdrop-filter: blur(25px) saturate(var(--saturation));
      border-radius: var(--border-radius);
      padding: 32px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      box-shadow: inset 0 0 0 1px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 10%),
            transparent
          ),
        inset 1.8px 3px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 90%),
            transparent
          ),
        inset -2px -2px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 80%),
            transparent
          ),
        inset -3px -8px 1px -6px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 60%),
            transparent
          ),
        inset -0.3px -1px 4px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 12%),
            transparent
          ),
        inset -1.5px 2.5px 0px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 20%),
            transparent
          ),
        inset 0px 3px 4px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 20%),
            transparent
          ),
        inset 2px -6.5px 1px -4px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 10%),
            transparent
          ),
        0px 1px 5px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 10%),
            transparent
          ),
        0px 6px 16px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 8%),
            transparent
          );
      transform: translateY(20px);
      opacity: 0;
      animation: fadeUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    @keyframes fadeUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Logo */
    .logo {
      width: 80px;
      height: 80px;
      border-radius: 22px;
      background: color-mix(in srgb, var(--c-action) 80%, transparent);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px
        color-mix(in srgb, var(--c-action) 30%, transparent);
      transform: scale(0.9);
      animation: scaleIn 0.6s 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)
        forwards;
    }

    .logo svg {
      width: 40px;
      height: 40px;
      fill: var(--c-light);
    }

    @keyframes scaleIn {
      to {
        transform: scale(1);
      }
    }

    /* Text content */
    .content {
      text-align: center;
      width: 100%;
    }

    h1 {
      font-size: clamp(1.75rem, 5vw, 2rem);
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
      letter-spacing: -0.02em;
    }

    p {
      font-size: clamp(1rem, 3vw, 1.125rem);
      color: var(--text-secondary);
      line-height: 1.5;
      max-width: 320px;
      margin: 0 auto;
    }

    /* Buttons container - Grid layout */
    .buttons {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    /* Individual button */
    .button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px 24px;
      background-color: color-mix(in srgb, var(--c-glass) 8%, transparent);
      backdrop-filter: blur(8px) saturate(var(--saturation));
      -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
      border: none;
      border-radius: 14px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      font-size: 1.125rem;
      transition: var(--transition);
      cursor: pointer;
      overflow: hidden;
      transform: translateY(10px);
      opacity: 0;
      animation: buttonAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)
        forwards;
      box-shadow: inset 0 0 0 1px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 10%),
            transparent
          ),
        inset 1.8px 3px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 90%),
            transparent
          ),
        inset -2px -2px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 80%),
            transparent
          ),
        inset -3px -8px 1px -6px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 60%),
            transparent
          ),
        inset -0.3px -1px 4px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 12%),
            transparent
          ),
        inset -1.5px 2.5px 0px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 20%),
            transparent
          ),
        inset 0px 3px 4px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 20%),
            transparent
          ),
        inset 2px -6.5px 1px -4px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 10%),
            transparent
          ),
        0px 1px 5px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 10%),
            transparent
          ),
        0px 6px 16px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 8%),
            transparent
          );
      min-height: 80px;
    }

    /* Full width button for odd number of links */
    .button.full-width {
      grid-column: span 2;
    }

    .button::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        color-mix(in srgb, var(--c-light) 10%, transparent),
        transparent
      );
      transition: left 0.6s ease;
    }

    .button:hover::before {
      left: 100%;
    }

    @keyframes buttonAppear {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .button:hover {
      transform: translateY(-2px) scale(1.02);
      background-color: color-mix(in srgb, var(--c-glass) 16%, transparent);
      box-shadow: inset 0 0 0 1px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 15%),
            transparent
          ),
        inset 1.8px 3px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 95%),
            transparent
          ),
        inset -2px -2px 0px -2px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 85%),
            transparent
          ),
        inset -3px -8px 1px -6px
          color-mix(
            in srgb,
            var(--c-light) calc(var(--glass-reflex-light) * 65%),
            transparent
          ),
        inset -0.3px -1px 4px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 15%),
            transparent
          ),
        inset -1.5px 2.5px 0px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 25%),
            transparent
          ),
        inset 0px 3px 4px -2px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 25%),
            transparent
          ),
        inset 2px -6.5px 1px -4px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 15%),
            transparent
          ),
        0px 1px 5px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 15%),
            transparent
          ),
        0px 6px 16px 0px
          color-mix(
            in srgb,
            var(--c-dark) calc(var(--glass-reflex-dark) * 12%),
            transparent
          );
    }

    .button:active {
      transform: translateY(0) scale(0.98);
      transition: all 0.1s ease;
    }

    .button-content {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
    }

    .button-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .button-icon svg {
      width: 100%;
      height: 100%;
      fill: var(--text-primary);
    }

    .button-label {
      flex: 1;
      text-align: left;
    }

    .button-tag {
      background: color-mix(in srgb, var(--c-action) 80%, transparent);
      color: white;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      letter-spacing: 0.02em;
    }

    /* Maker footer */
    .maker {
      margin-top: 20px;
      font-size: 0.875rem;
      color: var(--text-secondary);
      text-align: center;
      opacity: 0;
      animation: fadeIn 0.8s 1s ease forwards;
    }

    .maker a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .maker a:hover {
      color: var(--text-primary);
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    /* Status (load/error) */
    .status {
      margin-top: 6px;
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-align: center;
      min-height: 1.2em;
    }

    /* Responsive adjustments */
    @media (min-width: 768px) {
      .container {
        max-width: 800px;
      }

      .glass-card {
        padding: 40px 32px;
      }

      .button {
        padding: 18px 24px;
      }
    }

    @media (max-width: 480px) {
      .glass-card {
        padding: 24px 20px;
      }

      .button {
        padding: 14px 20px;
      }

      .buttons {
        grid-template-columns: 1fr;
      }

      .button.full-width {
        grid-column: span 1;
      }

      /* Mobile theme switcher position */
      .theme-switcher {
        top: 15px;
        right: 15px;
        width: 45px;
        padding: 6px;
      }

      .theme-switcher__option {
        width: 32px;
        height: 32px;
        padding: 6px;
      }
    }
  </style>
</head>
<body>
  <!-- Theme Switcher -->
  <fieldset class="theme-switcher">
    <legend class="theme-switcher__legend">Choose theme</legend>
    <label class="theme-switcher__option">
      <input class="theme-switcher__input" type="radio" name="theme" value="light" checked />
      <svg class="theme-switcher__icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 36 36">
        <path fill="var(--c)" fill-rule="evenodd" d="M18 12a6 6 0 1 1 0 12 6 6 0 0 1 0-12Zm0 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8Z" clip-rule="evenodd" />
        <path fill="var(--c)" d="M17 6.038a1 1 0 1 1 2 0v3a1 1 0 0 1-2 0v-3ZM24.244 7.742a1 1 0 1 1 1.618 1.176L24.1 11.345a1 1 0 1 1-1.618-1.176l1.763-2.427ZM29.104 13.379a1 1 0 0 1 .618 1.902l-2.854.927a1 1 0 1 1-.618-1.902l2.854-.927ZM29.722 20.795a1 1 0 0 1-.619 1.902l-2.853-.927a1 1 0 1 1 .618-1.902l2.854.927ZM25.862 27.159a1 1 0 0 1-1.618 1.175l-1.763-2.427a1 1 0 1 1 1.618-1.175l1.763 2.427ZM19 30.038a1 1 0 0 1-2 0v-3a1 1 0 1 1 2 0v3ZM11.755 28.334a1 1 0 0 1-1.618-1.175l1.764-2.427a1 1 0 1 1 1.618 1.175l-1.764 2.427ZM6.896 22.697a1 1 0 1 1-.618-1.902l2.853-.927a1 1 0 1 1 .618 1.902l-2.853.927ZM6.278 15.28a1 1 0 1 1 .618-1.901l2.853.927a1 1 0 1 1-.618 1.902l-2.853-.927ZM10.137 8.918a1 1 0 0 1 1.618-1.176l1.764 2.427a1 1 0 0 1-1.618 1.176l-1.764-2.427Z" />
      </svg>
    </label>
    <label class="theme-switcher__option">
      <input class="theme-switcher__input" type="radio" name="theme" value="dark" />
      <svg class="theme-switcher__icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 36 36">
        <path fill="var(--c)" d="M12.5 8.473a10.968 10.968 0 0 1 8.785-.97 7.435 7.435 0 0 0-3.737 4.672l-.09.373A7.454 7.454 0 0 0 28.732 20.4a10.97 10.97 0 0 1-5.232 7.125l-.497.27c-5.014 2.566-11.175.916-14.234-3.813l-.295-.483C5.53 18.403 7.13 11.93 12.017 8.77l.483-.297Zm4.234.616a8.946 8.946 0 0 0-2.805.883l-.429.234A9 9 0 0 0 10.206 22.5l.241.395A9 9 0 0 0 22.5 25.794l.416-.255a8.94 8.94 0 0 0 2.167-1.99 9.433 9.433 0 0 1-2.782-.313c-5.043-1.352-8.036-6.535-6.686-11.578l.147-.491c.242-.745.573-1.44.972-2.078Z" />
      </svg>
    </label>
  </fieldset>

  <div class="container">
    <div class="glass-card">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
          <path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2Zm9 7V7L15 5.5V7H9V5.5L3 7v2L9 10.5V12L5 13v2l6 1.5v-2l-6-1.5v-1L21 9Z"/>
        </svg>
      </div>

      <div class="content">
        <h1 id="title">Link Center</h1>
        <p id="subtitle">All my links in one place</p>
        <div id="status" class="status" role="status" aria-live="polite"></div>
      </div>

      <div class="buttons" id="buttons-container">
        <!-- Buttons will be dynamically generated here -->
      </div>
    </div>

    <div class="maker" id="maker-info">
      Made by <a href="https://your.site">YourName</a>
    </div>
  </div>

  <script>
    /**********************
     * CONFIG (editable)
     **********************/
    // If links.txt lives next to this HTML, just 'links.txt' is fine.
    const EXTERNAL_TXT_URL = 'links.txt';
    // true: only external links; false: merge with local LINKS below
    const REPLACE_LOCAL_LINKS = true;

    // Local defaults (used if external file fails)
    const SITE = { 
      title: "Link Center", 
      subtitle: "All my links in one place" 
    };
    
    const MAKER = { 
      name: "YourName", 
      url: "https://your.site" 
    };

    const LINKS = [
      { label: "Telegram", href: "https://t.me/...", icon: "paper-plane", tag: "Popular" },
      { label: "GitHub", href: "https://github.com/...", icon: "github", tag: "New" },
      { label: "Portfolio", href: "https://yourportfolio.com", icon: "globe" }
    ];

    // Minimal inline icons (add more if needed)
    const ICONS = {
      "paper-plane":"M2 21L23 12L2 3V10L17 12L2 14V21Z",
      "github":"M12 0C5.37 0 0 5.37 0 12C0 17.31 3.435 21.795 8.205 23.385C8.805 23.49 9.03 23.13 9.03 22.815C9.03 22.53 9.015 21.585 9.015 20.55C6 21.135 5.22 19.845 4.98 19.17C4.845 18.825 4.26 17.76 3.75 17.475C3.33 17.25 2.73 16.665 3.735 16.65C4.68 16.635 5.355 17.55 5.58 17.91C6.66 19.725 8.385 19.215 9.075 18.9C9.18 18.12 9.495 17.595 9.84 17.295C7.17 16.995 4.38 15.96 4.38 11.37C4.38 10.065 4.845 8.985 5.61 8.145C5.49 7.845 5.07 6.615 5.73 4.965C5.73 4.965 6.735 4.65 9.03 6.195C9.99 5.925 11.01 5.79 12.03 5.79C13.05 5.79 14.07 5.925 15.03 6.195C17.325 4.635 18.33 4.965 18.33 4.965C18.99 6.615 18.57 7.845 18.45 8.145C19.215 8.985 19.68 10.05 19.68 11.37C19.68 15.975 16.875 16.995 14.205 17.295C14.64 17.67 15.015 18.39 15.015 19.515C15.015 21.12 15 22.41 15 22.815C15 23.13 15.225 23.505 15.825 23.385C20.565 21.795 24 17.295 24 12C24 5.37 18.63 0 12 0Z",
      "twitter":"M22.46 6C21.69 6.35 20.86 6.58 20 6.69C20.88 6.16 21.56 5.32 21.88 4.31C21.05 4.81 20.13 5.16 19.16 5.36C18.37 4.5 17.26 4 16 4C13.65 4 11.73 5.92 11.73 8.29C11.73 8.63 11.77 8.96 11.84 9.27C8.28 9.09 5.11 7.38 3 4.79C2.63 5.42 2.42 6.16 2.42 6.94C2.42 8.43 3.17 9.75 4.33 10.5C3.62 10.5 2.96 10.3 2.38 10V10.03C2.38 12.11 3.86 13.85 5.82 14.24C5.19 14.4 4.53 14.42 3.89 14.31C4.16 15.16 4.69 15.88 5.37 16.4C6.05 16.92 6.86 17.21 7.69 17.22C6.11 18.49 4.12 19.13 2.04 19.13C1.7 19.13 1.36 19.11 1.02 19.07C3.01 20.29 5.35 21 7.78 21C16 21 20.33 14.46 20.33 8.79C20.33 8.6 20.33 8.42 20.32 8.23C21.16 7.63 21.88 6.87 22.46 6Z",
      "linkedin":"M19 0H5C2.24 0 0 2.24 0 5V19C0 21.76 2.24 24 5 24H19C21.76 24 24 21.76 24 19V5C24 2.24 21.76 0 19 0ZM8 19H5V8H8V19ZM6.5 6.73C5.53 6.73 4.75 5.96 4.75 5C4.75 4.04 5.53 3.27 6.5 3.27C7.47 3.27 8.25 4.04 8.25 5C8.25 5.96 7.47 6.73 6.5 6.73ZM20 19H17V13.4C17 11.28 15.57 10.01 13.98 10.01C12.39 10.01 11 11.28 11 13.4V19H8V8H11V9.56C11.66 8.7 13.08 7.75 14.75 7.75C17.78 7.75 20 9.98 20 13.4V19Z",
      "globe":"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM11 19.93C7.05 19.44 4 16.08 4 12C4 11.38 4.08 10.79 4.21 10.21L9 15V16C9 17.1 9.9 18 11 18V19.93ZM17.9 17.39C17.64 16.58 16.9 16 16 16H15V13C15 12.45 14.55 12 14 12H8V10H10C10.55 10 11 9.55 11 9V7H13C14.1 7 15 6.1 15 5V4.59C17.93 5.78 20 8.65 20 12C20 14.08 19.2 15.97 17.9 17.39Z",
      "envelope":"M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z"
    };

    /**********************
     * Helpers
     **********************/
    function setStatus(text) {
      const s = document.getElementById('status');
      s.textContent = text || '';
    }

    function clearButtons() {
      const c = document.getElementById('buttons-container');
      while (c.firstChild) c.removeChild(c.firstChild);
    }

    function createButton({ label, href, icon, tag }, index) {
      const a = document.createElement('a');
      a.href = href;
      a.className = 'button';
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.style.animationDelay = `${0.3 + index * 0.08}s`;

      const wrap = document.createElement('div');
      wrap.className = 'button-content';

      const ic = document.createElement('div');
      ic.className = 'button-icon';
      ic.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><path d="${ICONS[icon] || ICONS['globe']}"></path></svg>`;

      const lbl = document.createElement('div');
      lbl.className = 'button-label';
      lbl.textContent = label;

      wrap.appendChild(ic);
      wrap.appendChild(lbl);

      if (tag) {
        const tg = document.createElement('div');
        tg.className = 'button-tag';
        tg.textContent = tag;
        wrap.appendChild(tg);
      }

      a.appendChild(wrap);
      return a;
    }

    function renderButtons(linkArray) {
      const c = document.getElementById('buttons-container');
      clearButtons();
      
      // Add buttons to container
      linkArray.forEach((lnk, i) => c.appendChild(createButton(lnk, i)));
      
      // Handle grid layout for odd number of links
      if (linkArray.length % 2 === 1 && linkArray.length > 1) {
        const lastButton = c.lastChild;
        lastButton.classList.add('full-width');
      }
    }

    function applySiteMeta(meta) {
      if (meta.siteTitle) document.getElementById('title').textContent = meta.siteTitle;
      if (meta.siteSubtitle) document.getElementById('subtitle').textContent = meta.siteSubtitle;
      if (meta.makerName || meta.makerUrl) {
        const mk = document.getElementById('maker-info');
        const name = meta.makerName || MAKER.name;
        const url = meta.makerUrl || MAKER.url;
        mk.innerHTML = `Made by <a href="${url}" rel="noopener" target="_blank">${name}</a>`;
      }
    }

    /**********************
     * Parser for links.txt
     * Format:
     *  # comment
     *  @siteTitle=Link Center
     *  @siteSubtitle=Pick your group
     *  @makerName=YourName
     *  @makerUrl=https://your.site
     *
     *  Kindergarten | https://t.me/abc | child | New
     *  Advanced Programming | https://t.me/xyz | code
     *  Mathematics | https://t.me/math
     **********************/
    function parseLinksTxt(raw) {
      const lines = raw.split(/\r?\n/);
      const meta = {};
      const items = [];

      for (let rawLine of lines) {
        const line = rawLine.trim();
        if (!line || line.startsWith('#')) continue;

        if (line.startsWith('@')) {
          const eq = line.indexOf('=');
          if (eq > 1) {
            const key = line.slice(1, eq).trim();
            const val = line.slice(eq + 1).trim();
            if (key && val) {
              if (key === 'siteTitle') meta.siteTitle = val;
              else if (key === 'siteSubtitle') meta.siteSubtitle = val;
              else if (key === 'makerName') meta.makerName = val;
              else if (key === 'makerUrl') meta.makerUrl = val;
            }
          }
          continue;
        }

        const parts = line.split('|').map(s => s.trim()).filter(Boolean);
        if (parts.length >= 2) {
          const [label, href, icon, tag] = parts;
          items.push({ label, href, icon, tag });
        }
      }

      return { meta, items };
    }

    async function loadExternalTxt(url) {
      setStatus('Loading links...');
      
      // Try multiple approaches for better compatibility
      const methods = [
        // Method 1: XMLHttpRequest (best for local file access)
        () => new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', url, true);
          xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
              if (xhr.status === 0 || xhr.status === 200) {
                resolve(xhr.responseText);
              } else {
                reject(new Error(`HTTP ${xhr.status}`));
              }
            }
          };
          xhr.onerror = () => reject(new Error('Network error'));
          xhr.send();
        }),
        
        // Method 2: Standard fetch
        async () => {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.text();
        },
        
        // Method 3: Fetch with no-cors
        async () => {
          const res = await fetch(url, { cache: 'no-store', mode: 'no-cors' });
          return await res.text();
        }
      ];
      
      // Try each method until one succeeds
      for (const method of methods) {
        try {
          const txt = await method();
          if (txt && txt.trim().length > 0) {
            const { meta, items } = parseLinksTxt(txt);
            
            // Apply site metadata
            applySiteMeta(meta);
            
            // Render links
            const finalLinks = REPLACE_LOCAL_LINKS ? items : [...LINKS, ...items];
            renderButtons(finalLinks);
            
            setStatus('');
            return;
          }
        } catch (err) {
          console.warn('Method failed:', err);
          continue;
        }
      }
      
      // If all methods fail, use local defaults
      console.warn('Could not load external links. Using local defaults.');
      setStatus('Could not load external links. Using local defaults.');
      renderButtons(LINKS);
    }

    /**********************
     * Theme Switching
     **********************/
    document.addEventListener('DOMContentLoaded', function() {
      // Theme switcher functionality
      const themeSwitcher = document.querySelector('.theme-switcher');
      const radios = themeSwitcher.querySelectorAll('input[type="radio"]');

      radios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'dark') {
            document.body.classList.add('dark-theme');
          } else {
            document.body.classList.remove('dark-theme');
          }
        });
      });

      // Initial local meta (in case external file fails)
      document.getElementById('title').textContent = SITE.title;
      document.getElementById('subtitle').textContent = SITE.subtitle;
      document.getElementById('maker-info').innerHTML =
        `Made by <a href="${MAKER.url}" rel="noopener" target="_blank">${MAKER.name}</a>`;

      // Load external links
      loadExternalTxt(EXTERNAL_TXT_URL);
    });
  </script>
</body>
</html>
